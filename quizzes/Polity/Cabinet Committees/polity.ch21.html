<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 21: Cabinet Committees Quiz</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #000428, #004e92);
            --glass: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --correct: #00d2ff;
            --wrong: #ff416c;
            --hindi-dim: #b2bec3;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Poppins', sans-serif; }

        body {
            background: var(--bg-gradient);
            background-size: 400% 400%;
            animation: gradientAnim 10s ease infinite;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px;
            color: white;
            overflow-x: hidden;
        }

        @keyframes gradientAnim {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        #progress-bar-container {
            position: fixed;
            top: 0; left: 0;
            width: 100%;
            height: 5px;
            background: rgba(255,255,255,0.1);
            z-index: 1000;
        }

        #progress-bar {
            height: 100%;
            width: 0%;
            background: #00d2ff;
            box-shadow: 0 0 15px #00d2ff;
            transition: width 0.4s ease;
        }

        .card {
            background: var(--glass);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid var(--glass-border);
            border-radius: 30px;
            width: 100%;
            max-width: 600px;
            padding: 30px;
            box-shadow: 0 20px 45px rgba(0,0,0,0.4);
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
        }

        .card::-webkit-scrollbar { width: 3px; }
        .card::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.3); }

        .screen { display: none; text-align: center; }
        .active { display: block; }

        .header-meta {
            display: flex;
            justify-content: space-between;
            margin-bottom: 25px;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        h2 { font-size: 1.2rem; font-weight: 600; line-height: 1.5; margin-bottom: 12px; text-align: left; }
        .hindi-sub { font-size: 1rem; color: var(--hindi-dim); font-weight: 400; display: block; margin-top: 6px; line-height: 1.4; }

        .options-container { display: flex; flex-direction: column; gap: 12px; margin-top: 25px; }

        .option-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            padding: 16px;
            border-radius: 15px;
            color: white;
            text-align: left;
            cursor: pointer;
            transition: 0.3s;
            width: 100%;
        }

        .option-btn:hover:not(:disabled) { background: rgba(255,255,255,0.15); transform: translateY(-2px); }

        .correct { background: #00b894 !important; border-color: transparent; box-shadow: 0 0 20px rgba(0,184,148,0.4); }
        .wrong { background: #d63031 !important; border-color: transparent; animation: shake 0.4s; }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }

        .pulse-red { color: #ff7675; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }

        .finish-btn {
            margin-top: 25px;
            background: transparent;
            border: 1px solid rgba(255,255,255,0.2);
            color: rgba(255,255,255,0.4);
            padding: 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            width: 100%;
            cursor: pointer;
        }

        #sad-emoji {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 150px;
            z-index: 9999;
            display: none;
        }

        .primary-btn {
            background: linear-gradient(to right, #00d2ff, #3a7bd5);
            color: white;
            padding: 16px 45px;
            border-radius: 50px;
            border: none;
            font-weight: 700;
            cursor: pointer;
            margin-top: 30px;
            transition: 0.3s;
        }

        .primary-btn:hover { box-shadow: 0 10px 25px rgba(0,210,255,0.4); transform: scale(1.05); }

        .confetti { position: fixed; width: 6px; height: 6px; z-index: 9999; pointer-events: none; }
    </style>
</head>
<body>

<div id="progress-bar-container"><div id="progress-bar"></div></div>
<div id="sad-emoji">üò¢</div>

<div class="card">
    <div id="start-screen" class="screen active">
        <h1 style="margin-bottom: 15px;">Final Challenge</h1>
        <p style="font-size: 0.95rem; opacity: 0.7; margin-bottom: 30px;">Chapter 21: Cabinet Committees</p>
        
        <div style="margin-bottom: 25px;">
            <label>Timer (Seconds):</label><br>
            <input type="number" id="timer-input" value="0" style="background:rgba(255,255,255,0.1); border:1px solid #fff; color:#fff; padding:8px; border-radius:10px; width:80px; text-align:center; margin-top:10px;">
        </div>

        <div style="margin-bottom: 30px;">
            <label style="cursor: pointer;"><input type="checkbox" id="shuffle-input"> Shuffle Questions</label>
        </div>

        <button class="primary-btn" onclick="initQuiz()">Launch Quiz</button>
    </div>

    <div id="quiz-screen" class="screen">
        <div class="header-meta">
            <div id="counter">01/09</div>
            <div id="timer-display" style="display:none;">‚è±Ô∏è <span id="time-left">0</span></div>
            <div id="score">SCORE: 00</div>
        </div>
        
        <div id="q-area">
            <h2 id="q-text-en">Question text?</h2>
            <span id="q-text-hi" class="hindi-sub">‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§Ø‡§π‡§æ‡§Å ‡§Ü‡§è‡§ó‡§æ</span>
            <div class="options-container" id="options-grid"></div>
        </div>

        <button class="finish-btn" onclick="showResults()">Finish and Exit</button>
    </div>

    <div id="result-screen" class="screen">
        <h1 id="res-title">Results</h1>
        <div style="font-size: 4rem; font-weight: 700; margin: 20px 0;" id="res-score">0/9</div>
        <p id="res-msg" style="margin-bottom: 30px;"></p>
        <button class="primary-btn" onclick="location.reload()">Back to Start</button>
    </div>
</div>

<script>
const rawData = [
    {
        en: "What type of body are Cabinet Committees?",
        hi: "‡§Æ‡§Ç‡§§‡•ç‡§∞‡§ø‡§Æ‡§Ç‡§°‡§≤‡•Ä‡§Ø ‡§∏‡§Æ‡§ø‡§§‡§ø‡§Ø‡§æ‡§Ç ‡§ï‡§ø‡§∏ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§ï‡•Ä ‡§∏‡§Ç‡§∏‡•ç‡§•‡§æ ‡§π‡•à ?",
        opts: [
            {en: "Constitutional", hi: "‡§∏‡§Ç‡§µ‡•à‡§ß‡§æ‡§®‡§ø‡§ï", correct: false},
            {en: "Extra-Constitutional", hi: "‡§∏‡§Ç‡§µ‡§ø‡§ß‡§æ‡§®‡•á‡§§‡•ç‡§§‡§∞", correct: true},
            {en: "Statutory", hi: "‡§∏‡§æ‡§µ‡§ø‡§ß‡§ø‡§ï", correct: false},
            {en: "None of these", hi: "‡§á‡§®‡§Æ‡•á‡§Ç ‡§∏‡•á ‡§ï‡•ã‡§à ‡§®‡§π‡•Ä‡§Ç", correct: false}
        ]
    },
    {
        en: "Consider the following statements:\n1. Cabinet Committees are of two types.\n2. Standing committees are of a permanent nature, while ad hoc committees are constituted from time to time.",
        hi: "‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§ï‡§•‡§®‡•ã‡§Ç ‡§™‡§∞ ‡§µ‡§ø‡§ö‡§æ‡§∞ ‡§ï‡•Ä‡§ú‡§ø‡§è:\n1. ‡§Æ‡§Ç‡§§‡•ç‡§∞‡§ø‡§Æ‡§Ç‡§°‡§≤‡•Ä‡§Ø ‡§∏‡§Æ‡§ø‡§§‡§ø‡§Ø‡§æ‡§Ç ‡§¶‡•ã ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§ï‡•Ä ‡§π‡•ã‡§§‡•Ä ‡§π‡•à‡•§\n2. ‡§∏‡•ç‡§•‡§æ‡§Ø‡•Ä ‡§∏‡§Æ‡§ø‡§§‡§ø‡§Ø‡§æ‡§Ç ‡§∏‡•ç‡§•‡§æ‡§Ø‡•Ä ‡§™‡•ç‡§∞‡§ï‡•É‡§§‡§ø ‡§ï‡•Ä ‡§π‡•ã‡§§‡•Ä ‡§π‡•à ‡§ú‡§¨‡§ï‡§ø ‡§§‡§¶‡§∞‡•ç‡§• ‡§∏‡§Æ‡§ø‡§§‡§ø‡§Ø‡§æ‡§Ç ‡§∏‡§Æ‡§Ø-‡§∏‡§Æ‡§Ø ‡§™‡§∞ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à‡•§",
        opts: [
            {en: "Only 1", hi: "‡§ï‡•á‡§µ‡§≤ 1", correct: false},
            {en: "Only 2", hi: "‡§ï‡•á‡§µ‡§≤ 2", correct: false},
            {en: "Both 1 and 2", hi: "1 ‡§î‡§∞ 2 ‡§¶‡•ã‡§®‡•ã‡§Ç", correct: true},
            {en: "Neither 1 nor 2", hi: "‡§® ‡§§‡•ã 1 ‡§î‡§∞ ‡§® ‡§π‡•Ä 2", correct: false}
        ]
    },
    {
        en: "What can be the number of members of Cabinet Committees?",
        hi: "‡§Æ‡§Ç‡§§‡•ç‡§∞‡§ø‡§Æ‡§Ç‡§°‡§≤‡•Ä‡§Ø ‡§∏‡§Æ‡§ø‡§§‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•Ä ‡§∏‡§¶‡§∏‡•ç‡§Ø‡•ã‡§Ç ‡§ï‡•Ä ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§π‡•ã ‡§∏‡§ï‡§§‡•Ä ‡§π‡•à-",
        opts: [
            {en: "4 to 10", hi: "4 ‡§∏‡•á 10", correct: false},
            {en: "3 to 8", hi: "3 ‡§∏‡•á 8", correct: true},
            {en: "8 to 14", hi: "8 ‡§∏‡•á 14", correct: false},
            {en: "2 to 7", hi: "2 ‡§∏‡•á 7", correct: false}
        ]
    },
    {
        en: "Consider the following statements:\n1. Generally, only Cabinet ministers are members of the Cabinet Committee.\n2. Prime Minister is usually the head of committees, but sometimes Home or Finance Minister also chairs them.",
        hi: "‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§ï‡§•‡§®‡•ã‡§Ç ‡§™‡§∞ ‡§µ‡§ø‡§ö‡§æ‡§∞ ‡§ï‡•Ä‡§ú‡§ø‡§è:\n1. ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø‡§§‡§É ‡§Æ‡§Ç‡§§‡•ç‡§∞‡§ø‡§Æ‡§Ç‡§°‡§≤‡•Ä‡§Ø ‡§∏‡§Æ‡§ø‡§§‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡§æ ‡§∏‡§¶‡§∏‡•ç‡§Ø ‡§ï‡•à‡§¨‡§ø‡§®‡•á‡§ü ‡§Æ‡§Ç‡§§‡•ç‡§∞‡•Ä ‡§π‡•ã‡§§‡§æ ‡§π‡•à‡•§\n2. ‡§∏‡§Æ‡§ø‡§§‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•á ‡§™‡•ç‡§∞‡§Æ‡•Å‡§ñ ‡§™‡•ç‡§∞‡§æ‡§Ø‡§É ‡§™‡•ç‡§∞‡§ß‡§æ‡§®‡§Æ‡§Ç‡§§‡•ç‡§∞‡•Ä ‡§π‡•ã‡§§‡•á ‡§π‡•à‡§Ç ‡§≤‡•á‡§ï‡§ø‡§® ‡§ï‡§≠‡•Ä-‡§ï‡§≠‡•Ä ‡§µ‡§ø‡§§‡•ç‡§§ ‡§Æ‡§Ç‡§§‡•ç‡§∞‡•Ä ‡§î‡§∞ ‡§ó‡•É‡§π ‡§Æ‡§Ç‡§§‡•ç‡§∞‡•Ä ‡§≠‡•Ä ‡§Ö‡§ß‡•ç‡§Ø‡§ï‡•ç‡§∑‡§§‡§æ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç‡•§",
        opts: [
            {en: "Only 1", hi: "‡§ï‡•á‡§µ‡§≤ 1", correct: false},
            {en: "Only 2", hi: "‡§ï‡•á‡§µ‡§≤ 2", correct: false},
            {en: "Both 1 and 2", hi: "1 ‡§î‡§∞ 2 ‡§¶‡•ã‡§®‡•ã‡§Ç", correct: true},
            {en: "Neither 1 nor 2", hi: "‡§® ‡§§‡•ã 1 ‡§î‡§∞ ‡§® ‡§π‡•Ä 2", correct: false}
        ]
    },
    {
        en: "Who chairs the Cabinet Committee on Parliamentary Affairs?",
        hi: "‡§∏‡§Ç‡§∏‡§¶‡•Ä‡§Ø ‡§Æ‡§æ‡§Æ‡§≤‡•ã‡§Ç ‡§ï‡•Ä ‡§Æ‡§Ç‡§§‡•ç‡§∞‡§ø‡§Æ‡§Ç‡§°‡§≤‡•Ä‡§Ø ‡§∏‡§Æ‡§ø‡§§‡§ø ‡§ï‡•Ä ‡§Ö‡§ß‡•ç‡§Ø‡§ï‡•ç‡§∑‡§§‡§æ ‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§Æ‡•á‡§Ç ‡§∏‡•á ‡§ï‡•å‡§® ‡§ï‡§∞‡§§‡§æ ‡§π‡•à ?",
        opts: [
            {en: "Prime Minister", hi: "‡§™‡•ç‡§∞‡§ß‡§æ‡§®‡§Æ‡§Ç‡§§‡•ç‡§∞‡•Ä", correct: false},
            {en: "Minister of Parliamentary Affairs", hi: "‡§∏‡§Ç‡§∏‡§¶‡•Ä‡§Ø ‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§Æ‡§Ç‡§§‡•ç‡§∞‡•Ä", correct: false},
            {en: "Home Minister", hi: "‡§ó‡•É‡§π ‡§Æ‡§Ç‡§§‡•ç‡§∞‡•Ä", correct: true},
            {en: "Finance Minister", hi: "‡§µ‡§ø‡§§‡•ç‡§§ ‡§Æ‡§Ç‡§§‡•ç‡§∞‡•Ä", correct: false}
        ]
    },
    {
        en: "Who chairs the Cabinet Committee on Political Affairs?",
        hi: "‡§∞‡§æ‡§ú‡§®‡•Ä‡§§‡§ø‡§ï ‡§Æ‡§æ‡§Æ‡§≤‡•ã‡§Ç ‡§∏‡•á ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§Æ‡§Ç‡§§‡•ç‡§∞‡§ø‡§Æ‡§Ç‡§°‡§≤‡•Ä‡§Ø ‡§∏‡§Æ‡§ø‡§§‡§ø ‡§ï‡•Ä ‡§Ö‡§ß‡•ç‡§Ø‡§ï‡•ç‡§∑‡§§‡§æ ‡§ï‡•å‡§® ‡§ï‡§∞‡§§‡§æ ‡§π‡•à ?",
        opts: [
            {en: "Prime Minister", hi: "‡§™‡•ç‡§∞‡§ß‡§æ‡§®‡§Æ‡§Ç‡§§‡•ç‡§∞‡•Ä", correct: true},
            {en: "Home Minister", hi: "‡§ó‡•É‡§π‡§Æ‡§Ç‡§§‡•ç‡§∞‡•Ä", correct: false},
            {en: "Finance Minister", hi: "‡§µ‡§ø‡§§‡•ç‡§§ ‡§Æ‡§Ç‡§§‡•ç‡§∞‡•Ä", correct: false},
            {en: "Defense Minister", hi: "‡§∞‡§ï‡•ç‡§∑‡§æ ‡§Æ‡§Ç‡§§‡•ç‡§∞‡•Ä", correct: false}
        ]
    },
    {
        en: "Who chairs the Cabinet Committee on Economic Affairs?",
        hi: "‡§Ü‡§∞‡•ç‡§•‡§ø‡§ï ‡§Æ‡§æ‡§Æ‡§≤‡•ã‡§Ç ‡§∏‡•á ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§Æ‡§Ç‡§§‡•ç‡§∞‡§ø‡§Æ‡§Ç‡§°‡§≤‡•Ä‡§Ø ‡§∏‡§Æ‡§ø‡§§‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•Ä ‡§Ö‡§ß‡•ç‡§Ø‡§ï‡•ç‡§∑‡§§‡§æ ‡§ï‡•å‡§® ‡§ï‡§∞‡§§‡§æ ‡§π‡•à ?",
        opts: [
            {en: "Finance Minister", hi: "‡§µ‡§ø‡§§‡•ç‡§§ ‡§Æ‡§Ç‡§§‡•ç‡§∞‡•Ä", correct: false},
            {en: "Home Minister", hi: "‡§ó‡•É‡§π ‡§Æ‡§Ç‡§§‡•ç‡§∞‡•Ä", correct: false},
            {en: "Prime Minister", hi: "‡§™‡•ç‡§∞‡§ß‡§æ‡§®‡§Æ‡§Ç‡§§‡•ç‡§∞‡•Ä", correct: true},
            {en: "Defense Minister", hi: "‡§∞‡§ï‡•ç‡§∑‡§æ ‡§Æ‡§Ç‡§§‡•ç‡§∞‡•Ä", correct: false}
        ]
    },
    {
        en: "Which committee is called the 'Super Cabinet'?",
        hi: "‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§Æ‡•á‡§Ç ‡§∏‡•á ‡§ï‡§ø‡§∏ ‡§∏‡§Æ‡§ø‡§§‡§ø ‡§ï‡•ã ‡§∏‡•Å‡§™‡§∞ ‡§ï‡•à‡§¨‡§ø‡§®‡•á‡§ü ‡§ï‡§π‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à ?",
        opts: [
            {en: "Committee on Political Affairs", hi: "‡§∞‡§æ‡§ú‡§®‡•Ä‡§§‡§ø‡§ï ‡§Æ‡§æ‡§Æ‡§≤‡•ã‡§Ç ‡§ï‡•Ä ‡§∏‡§Æ‡§ø‡§§‡§ø", correct: true},
            {en: "Cabinet Appointment Committee", hi: "‡§Æ‡§Ç‡§§‡•ç‡§∞‡§ø‡§Æ‡§Ç‡§°‡§≤ ‡§ï‡•Ä ‡§®‡§ø‡§Ø‡•Å‡§ï‡•ç‡§§‡§ø ‡§∏‡§Æ‡§ø‡§§‡§ø", correct: false},
            {en: "Committee on Economic Affairs", hi: "‡§Ü‡§∞‡•ç‡§•‡§ø‡§ï ‡§Æ‡§æ‡§Æ‡§≤‡•ã‡§Ç ‡§∏‡•á ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§∏‡§Æ‡§ø‡§§‡§ø", correct: false},
            {en: "Committee on Parliamentary Affairs", hi: "‡§∏‡§Ç‡§∏‡§¶‡•Ä‡§Ø ‡§Æ‡§æ‡§Æ‡§≤‡•ã‡§Ç ‡§ï‡•Ä ‡§∏‡§Æ‡§ø‡§§‡§ø", correct: false}
        ]
    },
    {
        en: "How many Cabinet Committees are currently functional?",
        hi: "‡§µ‡§∞‡•ç‡§§‡•ç‡§§‡§Æ‡§æ‡§® ‡§Æ‡•á‡§Ç ‡§ï‡§ø‡§§‡§®‡•á ‡§Æ‡§Ç‡§§‡•ç‡§∞‡§ø‡§Æ‡§£‡•ç‡§°‡§≤ ‡§∏‡§Æ‡§ø‡§§‡§ø‡§Ø‡§æ‡§Ç ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§∞‡§§ ‡§π‡•à‡§Ç ?",
        opts: [
            {en: "7", hi: "7", correct: false},
            {en: "6", hi: "6", correct: false},
            {en: "8", hi: "8", correct: true},
            {en: "12", hi: "12", correct: false}
        ]
    }
];

let quiz = [];
let currentIdx = 0;
let scoreVal = 0;
let timerRef = null;
let timerDuration = 0;
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function playTone(freq, type) {
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = type;
    osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start();
    gain.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + 1);
    osc.stop(audioCtx.currentTime + 1);
}

function initQuiz() {
    const isShuffle = document.getElementById('shuffle-input').checked;
    timerDuration = parseInt(document.getElementById('timer-input').value) || 0;
    quiz = isShuffle ? [...rawData].sort(() => Math.random() - 0.5) : [...rawData];
    document.getElementById('start-screen').classList.remove('active');
    document.getElementById('quiz-screen').classList.add('active');
    loadQuestion();
}

function loadQuestion() {
    if (currentIdx >= quiz.length) return showResults();
    clearInterval(timerRef);
    const q = quiz[currentIdx];
    document.getElementById('counter').innerText = `${String(currentIdx + 1).padStart(2, '0')}/${quiz.length}`;
    document.getElementById('score').innerText = `SCORE: ${scoreVal}`;
    document.getElementById('q-text-en').innerText = q.en;
    document.getElementById('q-text-hi').innerText = q.hi;
    document.getElementById('progress-bar').style.width = `${(currentIdx / quiz.length) * 100}%`;
    const grid = document.getElementById('options-grid');
    grid.innerHTML = '';
    q.opts.forEach((opt, i) => {
        const btn = document.createElement('button');
        btn.className = 'option-btn';
        btn.innerHTML = `<div>${opt.en}</div><div class="hindi-sub">${opt.hi}</div>`;
        btn.onclick = () => handleSelect(btn, opt.correct);
        grid.appendChild(btn);
    });
    if (timerDuration > 0) startTimer();
    else document.getElementById('timer-display').style.display = 'none';
}

function startTimer() {
    let time = timerDuration;
    const display = document.getElementById('timer-display');
    const text = document.getElementById('time-left');
    display.style.display = 'block';
    text.innerText = time;
    text.classList.remove('pulse-red');
    timerRef = setInterval(() => {
        time--;
        text.innerText = time;
        if (time <= 5) text.classList.add('pulse-red');
        if (time <= 0) { clearInterval(timerRef); autoFail(); }
    }, 1000);
}

function handleSelect(btn, isCorrect) {
    clearInterval(timerRef);
    const btns = document.querySelectorAll('.option-btn');
    btns.forEach(b => b.disabled = true);
    if (isCorrect) {
        btn.classList.add('correct');
        scoreVal++;
        playTone(900, 'sine');
        spawnConfetti();
    } else {
        btn.classList.add('wrong');
        playTone(200, 'sawtooth');
        document.getElementById('sad-emoji').style.display = 'block';
        setTimeout(() => document.getElementById('sad-emoji').style.display = 'none', 1000);
        btns.forEach((b, idx) => { if (quiz[currentIdx].opts[idx].correct) b.classList.add('correct'); });
    }
    setTimeout(() => { currentIdx++; loadQuestion(); }, 1500);
}

function autoFail() {
    const btns = document.querySelectorAll('.option-btn');
    btns.forEach((b, idx) => {
        b.disabled = true;
        if (quiz[currentIdx].opts[idx].correct) b.classList.add('correct');
    });
    playTone(200, 'sawtooth');
    setTimeout(() => { currentIdx++; loadQuestion(); }, 1500);
}

function showResults() {
    clearInterval(timerRef);
    document.getElementById('quiz-screen').classList.remove('active');
    document.getElementById('result-screen').classList.add('active');
    document.getElementById('progress-bar').style.width = '100%';
    const percent = (scoreVal / quiz.length) * 100;
    document.getElementById('res-score').innerText = `${scoreVal}/${quiz.length}`;
    if (percent >= 80) document.getElementById('res-msg').innerText = "üèÜ Outstanding Performance!";
    else if (percent >= 50) document.getElementById('res-msg').innerText = "üëè Well Done!";
    else document.getElementById('res-msg').innerText = "üìö Keep Studying!";
}

function spawnConfetti() {
    for (let i = 0; i < 30; i++) {
        const div = document.createElement('div');
        div.className = 'confetti';
        div.style.left = Math.random() * 100 + 'vw';
        div.style.top = '-10px';
        div.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
        document.body.appendChild(div);
        const anim = div.animate([
            { transform: 'translateY(0) rotate(0)', opacity: 1 },
            { transform: `translateY(100vh) rotate(360deg)`, opacity: 0 }
        ], { duration: 2500 });
        anim.onfinish = () => div.remove();
    }
}
</script>
</body>
</html>