<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ancient History: Iranian & Greek Invasions</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');

        :root {
            --primary: #ffffff;
            --text-eng: #ffffff;
            --text-hin: #e0e0e0;
            --correct: #00e676;
            --wrong: #ff1744;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Poppins', sans-serif;
            user-select: none; /* Prevent text selection */
        }

        body {
            min-height: 100vh;
            background: linear-gradient(45deg, #4facfe 0%, #00f2fe 25%, #66a6ff 50%, #89f7fe 75%, #6a11cb 100%);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
            color: white;
            overflow-x: hidden;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Glassmorphism Container */
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 25px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 600px;
            padding: 25px;
            position: relative;
            max-height: 95vh;
            overflow-y: auto; /* Scroll for mobile */
            transition: all 0.3s ease;
        }

        /* Scrollbar styling */
        .glass-card::-webkit-scrollbar {
            width: 6px;
        }
        .glass-card::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
        }

        /* Screens */
        .screen {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Start Screen */
        .start-header h1 {
            font-size: 2rem;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 25px;
        }

        .input-group {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        input[type="number"] {
            background: transparent;
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px;
            border-radius: 8px;
            width: 80px;
            text-align: center;
            font-size: 1rem;
        }

        /* Toggle Switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(255,255,255,0.3);
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider { background-color: var(--correct); }
        input:checked + .slider:before { transform: translateX(26px); }

        .btn-start, .btn-restart, .btn-finish {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 15px;
            background: white;
            color: #6a11cb;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn-start:hover, .btn-restart:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(255,255,255,0.3);
        }

        /* Quiz UI */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .progress-container {
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background: var(--correct);
            width: 0%;
            transition: width 0.3s ease;
            box-shadow: 0 0 10px var(--correct);
        }

        .timer-badge {
            background: rgba(0,0,0,0.3);
            padding: 5px 12px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .timer-badge.danger {
            color: #ff4d4d;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .question-box {
            margin-bottom: 25px;
        }
        .q-text-en {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 8px;
            line-height: 1.4;
        }
        .q-text-hi {
            font-size: 1rem;
            color: var(--text-hin);
            font-weight: 400;
            line-height: 1.5;
        }

        .options-grid {
            display: grid;
            gap: 12px;
        }

        .option-btn {
            background: rgba(255,255,255,0.15);
            border: 1px solid rgba(255,255,255,0.1);
            padding: 12px 15px;
            border-radius: 12px;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
        }
        .option-btn:hover:not(:disabled) {
            background: rgba(255,255,255,0.25);
        }
        .opt-en { font-weight: 600; font-size: 1rem; margin-bottom: 2px; }
        .opt-hi { font-size: 0.85rem; color: #ddd; }

        .option-btn.correct {
            background: var(--correct);
            border-color: var(--correct);
            color: #004d26;
        }
        .option-btn.correct .opt-hi { color: #004d26; }

        .option-btn.wrong {
            background: var(--wrong);
            border-color: var(--wrong);
            color: white;
        }
        .option-btn:disabled {
            cursor: default;
            opacity: 0.9;
        }

        .btn-finish {
            margin-top: 25px;
            background: rgba(255, 50, 50, 0.8);
            color: white;
            font-size: 1rem;
            padding: 10px;
        }

        /* Result Screen */
        .result-box {
            text-align: center;
        }
        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 8px solid rgba(255,255,255,0.3);
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            margin: 0 auto 20px;
            background: rgba(0,0,0,0.1);
        }
        .score-number { font-size: 3rem; font-weight: bold; }
        .score-total { font-size: 1rem; opacity: 0.8; }
        .message { font-size: 1.4rem; margin-bottom: 30px; }

        /* Animations & Emojis */
        .feedback-emoji {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            font-size: 5rem;
            z-index: 9999;
            pointer-events: none;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .feedback-emoji.show {
            transform: translate(-50%, -50%) scale(1);
            animation: shake 0.5s ease-in-out;
        }
        @keyframes shake {
            0%, 100% { transform: translate(-50%, -50%) rotate(0deg); }
            25% { transform: translate(-50%, -50%) rotate(-15deg); }
            75% { transform: translate(-50%, -50%) rotate(15deg); }
        }

        /* Confetti Canvas */
        #confetti-canvas {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 9998;
        }
        
        /* Mobile adjustments for very long text */
        @media (max-width: 400px) {
            .q-text-en { font-size: 1.1rem; }
            .q-text-hi { font-size: 0.9rem; }
            .start-header h1 { font-size: 1.5rem; }
        }
    </style>
</head>
<body>

    <canvas id="confetti-canvas"></canvas>
    <div id="emoji-display" class="feedback-emoji">üò¢</div>

    <div class="glass-card">
        <div id="start-screen" class="screen active">
            <div class="start-header">
                <h1>‚öîÔ∏è Ancient Invasions<br><span style="font-size: 1.2rem; font-weight:400; color:#ddd">Irani & Greek (Macedonian)</span></h1>
            </div>
            
            <div class="controls">
                <div class="input-group">
                    <div>
                        <div style="font-weight:bold">Timer per Q (sec)</div>
                        <div style="font-size:0.8rem; opacity:0.8">0 or empty to disable</div>
                    </div>
                    <input type="number" id="timerInput" placeholder="0" min="0">
                </div>

                <div class="input-group">
                    <div style="font-weight:bold">Shuffle Questions</div>
                    <label class="switch">
                        <input type="checkbox" id="shuffleToggle">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <button class="btn-start" onclick="startQuiz()">Start Quiz</button>
        </div>

        <div id="quiz-screen" class="screen">
            <div class="top-bar">
                <span id="question-counter">Q: 01/19</span>
                <div id="timer-display" class="timer-badge" style="display:none">
                    ‚è±Ô∏è <span id="time-left">00</span>s
                </div>
                <span id="score-display">Score: 0</span>
            </div>
            
            <div class="progress-container">
                <div id="progress-bar" class="progress-bar"></div>
            </div>

            <div class="question-box">
                <div id="q-text-en" class="q-text-en"></div>
                <div id="q-text-hi" class="q-text-hi"></div>
            </div>

            <div id="options-container" class="options-grid">
                </div>

            <button class="btn-finish" onclick="endQuiz()">üèÅ Finish & Show Results</button>
        </div>

        <div id="result-screen" class="screen">
            <div class="result-box">
                <div class="score-circle">
                    <span id="final-score" class="score-number">0</span>
                    <span id="total-qs" class="score-total">/ 19</span>
                </div>
                <div id="result-message" class="message"></div>
                <button class="btn-restart" onclick="location.reload()">üîÑ Restart Quiz</button>
            </div>
        </div>
    </div>

    <script>
        // --- DATA ---
        // Questions extracted from uploaded images (Questions 1-19)
        // Bilingual format (English | Hindi)
        const rawQuestions = [
            {
                id: 1,
                qEn: "The first foreign invasion of India was carried out by the kings of which place?",
                qHi: "‡§≠‡§æ‡§∞‡§§ ‡§™‡§∞ ‡§∏‡§∞‡•ç‡§µ‡§™‡•ç‡§∞‡§•‡§Æ ‡§µ‡§ø‡§¶‡•á‡§∂‡•Ä ‡§Ü‡§ï‡•ç‡§∞‡§Æ‡§£ ‡§ï‡§π‡§æ‡§Å ‡§ï‡•á ‡§∞‡§æ‡§ú‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§π‡•Å‡§Ü ‡§•‡§æ?",
                options: [
                    { en: "Greece", hi: "‡§Ø‡•Ç‡§®‡§æ‡§®", correct: false },
                    { en: "Arabia", hi: "‡§Ö‡§∞‡§¨‡•Ä", correct: false },
                    { en: "Iran", hi: "‡§à‡§∞‡§æ‡§®‡•Ä", correct: true },
                    { en: "Turkey", hi: "‡§§‡•Å‡§∞‡•ç‡§ï‡•Ä", correct: false }
                ]
            },
            {
                id: 2,
                qEn: "Who was the founder of the Achaemenid (Hakhmani) dynasty of Iran?",
                qHi: "‡§à‡§∞‡§æ‡§® ‡§ï‡•á ‡§π‡§ñ‡§Æ‡§®‡•Ä ‡§µ‡§Ç‡§∂ ‡§ï‡§æ ‡§∏‡§Ç‡§∏‡•ç‡§•‡§æ‡§™‡§ï ‡§ï‡•å‡§® ‡§•‡§æ?",
                options: [
                    { en: "Cyrus-II", hi: "‡§∏‡§æ‡§á‡§∞‡§∏-2", correct: true },
                    { en: "Darius I", hi: "‡§¶‡§æ‡§∞‡§æ ‡§™‡•ç‡§∞‡§•‡§Æ", correct: false },
                    { en: "Xerxes", hi: "‡§ú‡§∞‡§ï‡•ç‡§∏‡•Ä‡§ú", correct: false },
                    { en: "Darius III", hi: "‡§°‡•á‡§∞‡§ø‡§Ø‡§∏", correct: false }
                ]
            },
            {
                id: 3,
                qEn: "Which ruler of the Achaemenid dynasty died while fighting a tribe named Derbices/Urbike?",
                qHi: "‡§π‡§ñ‡§Æ‡§®‡•Ä ‡§µ‡§Ç‡§∂ ‡§ï‡•á ‡§ï‡§ø‡§∏ ‡§∂‡§æ‡§∏‡§ï ‡§ï‡•Ä ‡§Æ‡•É‡§§‡•ç‡§Ø‡•Å ‡§â‡§∞‡§¨‡§æ‡§á‡§ï ‡§®‡§æ‡§Æ‡§ï ‡§ú‡§®‡§ú‡§æ‡§§‡§ø ‡§∏‡•á ‡§≤‡•ú‡§§‡•á ‡§π‡•Å‡§è ‡§π‡•Å‡§à ‡§•‡•Ä?",
                options: [
                    { en: "Cyrus-II", hi: "‡§∏‡§æ‡§á‡§∞‡§∏-2", correct: true },
                    { en: "Darius I", hi: "‡§¶‡§æ‡§∞‡§æ ‡§™‡•ç‡§∞‡§•‡§Æ", correct: false },
                    { en: "Xerxes", hi: "‡§ú‡§∞‡§ï‡•ç‡§∏‡•Ä‡§ú", correct: false },
                    { en: "Cambyses II", hi: "‡§ï‡•à‡§Æ‡•ç‡§¨‡§ø‡§∏‡•Ä‡§ú-2", correct: false }
                ]
            },
            {
                id: 4,
                qEn: "Which Iranian king carried out the first successful invasion of India?",
                qHi: "‡§≠‡§æ‡§∞‡§§ ‡§™‡§∞ ‡§™‡•ç‡§∞‡§•‡§Æ ‡§∏‡§´‡§≤ ‡§Ü‡§ï‡•ç‡§∞‡§Æ‡§£ ‡§ï‡§ø‡§∏ ‡§à‡§∞‡§æ‡§®‡•Ä ‡§∞‡§æ‡§ú‡§æ ‡§®‡•á ‡§ï‡§ø‡§Ø‡§æ ‡§•‡§æ?",
                options: [
                    { en: "Xerxes", hi: "‡§ú‡§∞‡§ï‡•ç‡§∏‡•Ä‡§ú", correct: false },
                    { en: "Cyrus-II", hi: "‡§∏‡§æ‡§á‡§∞‡§∏-2", correct: false },
                    { en: "Darius I", hi: "‡§¶‡§æ‡§∞‡§æ ‡§™‡•ç‡§∞‡§•‡§Æ", correct: true },
                    { en: "Cambyses", hi: "‡§ï‡•ã‡§Æ‡•ç‡§¨‡§ø‡§∏‡•Ä‡§ú", correct: false }
                ]
            },
            {
                id: 5,
                qEn: "Which of the following statements is correct?\n1. Scylax explored the Arabian and Makran coast.\n2. Darius-1 first annexed Gandhara to the Persian Empire.\n3. Darius-1 also had control over Kamboj.\n4. Xerxes included Indians in his army.",
                qHi: "‡§®‡§ø‡§Æ‡•ç‡§® ‡§Æ‡•á ‡§ï‡•å‡§®-‡§∏‡§æ ‡§ï‡§•‡§® ‡§∏‡§π‡•Ä ‡§π‡•à‡§Ç?\n1. ‡§Ö‡§∞‡§¨ ‡§î‡§∞ ‡§Æ‡§ï‡§∞‡§æ‡§® ‡§§‡§ü ‡§ï‡§æ ‡§™‡§§‡§æ ‡§∏‡•ç‡§ï‡§æ‡§à‡§≤‡•á‡§ï‡•ç‡§∏ ‡§®‡•á ‡§≤‡§ó‡§æ‡§Ø‡§æ ‡§•‡§æ‡•§\n2. ‡§¶‡§æ‡§∞‡§æ-1 ‡§®‡•á ‡§π‡•Ä ‡§∏‡§∞‡•ç‡§µ‡§™‡•ç‡§∞‡§•‡§Æ ‡§ó‡§Ç‡§ß‡§æ‡§∞ ‡§ï‡•ã ‡§´‡§æ‡§∞‡§∏‡•Ä ‡§∏‡§æ‡§Æ‡•ç‡§∞‡§æ‡§ú‡•ç‡§Ø ‡§Æ‡•á‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡§Ø‡§æ ‡§•‡§æ‡•§\n3. ‡§¶‡§æ‡§∞‡§æ-1 ‡§ï‡§æ ‡§Ö‡§ß‡§ø‡§ï‡§æ‡§∞ ‡§ï‡§Ç‡§¨‡•ã‡§ú ‡§™‡§∞ ‡§≠‡•Ä ‡§•‡§æ‡•§\n4. ‡§ú‡§∞‡§ï‡•ç‡§∏‡•Ä‡§ú ‡§®‡•á ‡§Ö‡§™‡§®‡•Ä ‡§´‡•å‡§ú ‡§Æ‡•á‡§Ç ‡§≠‡§æ‡§∞‡§§‡•Ä‡§Ø‡•ã‡§Ç ‡§ï‡•ã ‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§ï‡§ø‡§Ø‡§æ‡•§",
                options: [
                    { en: "Only 3", hi: "‡§ï‡•á‡§µ‡§≤-3", correct: false },
                    { en: "1, 2, and 3", hi: "1, 2, ‡§î‡§∞ 3", correct: false },
                    { en: "2, 3 and 4", hi: "2, 3 ‡§î‡§∞ 4", correct: false },
                    { en: "1, 2, 3 and 4", hi: "1, 2, 3 ‡§î‡§∞ 4", correct: true }
                ]
            },
            {
                id: 6,
                qEn: "Who was the last ruler of the Achaemenid dynasty?",
                qHi: "‡§π‡§ñ‡§Æ‡§®‡•Ä ‡§µ‡§Ç‡§∂ ‡§ï‡§æ ‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§∂‡§æ‡§∏‡§ï ‡§ï‡•å‡§® ‡§•‡§æ?",
                options: [
                    { en: "Darius I", hi: "‡§¶‡§æ‡§∞‡§æ ‡§™‡•ç‡§∞‡§•‡§Æ", correct: false },
                    { en: "Xerxes", hi: "‡§ú‡§∞‡§ï‡•ç‡§∏‡•Ä‡§ú", correct: false },
                    { en: "Darius III", hi: "‡§¶‡§æ‡§∞‡§æ ‡§§‡•É‡§§‡•Ä‡§Ø", correct: true },
                    { en: "Cyrus-II", hi: "‡§∏‡§æ‡§á‡§∞‡§∏ -2", correct: false }
                ]
            },
            {
                id: 7,
                qEn: "Between whom was the Battle of Arbela / Gaugamela fought?",
                qHi: "‡§Ö‡§∞‡§¨‡•á‡§≤‡§æ/‡§ó‡•å‡§ó‡§Æ‡•á‡§≤‡§æ ‡§ï‡§æ ‡§Ø‡•Å‡§¶‡•ç‡§ß ‡§ï‡§ø‡§®‡§ï‡•á ‡§¨‡•Ä‡§ö ‡§π‡•Å‡§Ü ‡§•‡§æ?",
                options: [
                    { en: "Between Alexander and Darius III", hi: "‡§∏‡§ø‡§ï‡§Ç‡§¶‡§∞ ‡§î‡§∞ ‡§¶‡§æ‡§∞‡§æ-3 ‡§ï‡•á ‡§¨‡•Ä‡§ö", correct: true },
                    { en: "Between Darius I and Alexander", hi: "‡§¶‡§æ‡§∞‡§æ ‡§™‡•ç‡§∞‡§•‡§Æ ‡§î‡§∞ ‡§∏‡§ø‡§ï‡§Ç‡§¶‡§∞ ‡§ï‡•á ‡§¨‡•Ä‡§ö", correct: false },
                    { en: "Between Alexander and Porus", hi: "‡§∏‡§ø‡§ï‡§Ç‡§¶‡§∞ ‡§î‡§∞ ‡§™‡•ã‡§∞‡§∏ ‡§ï‡•á ‡§¨‡•Ä‡§ö", correct: false },
                    { en: "Between Darius III and Xerxes", hi: "‡§¶‡§æ‡§∞‡§æ-3 ‡§î‡§∞ ‡§ï‡•ç‡§∑‡§Ø‡§æ‡§∞‡•ç‡§∑ ‡§ï‡•á ‡§¨‡•Ä‡§ö", correct: false }
                ]
            },
            {
                id: 8,
                qEn: "Who carried out the first European invasion of India?",
                qHi: "‡§≠‡§æ‡§∞‡§§ ‡§Æ‡•á‡§Ç ‡§™‡§π‡§≤‡§æ ‡§Ø‡•Ç‡§∞‡•ã‡§™‡•Ä‡§Ø ‡§Ü‡§ï‡•ç‡§∞‡§Æ‡§£ ‡§ï‡§ø‡§∏‡§®‡•á ‡§ï‡§ø‡§Ø‡§æ ‡§•‡§æ?",
                options: [
                    { en: "Portuguese", hi: "‡§™‡•Å‡§∞‡•ç‡§§‡§ó‡§æ‡§≤‡•Ä", correct: false },
                    { en: "British", hi: "‡§Ö‡§Ç‡§ó‡•ç‡§∞‡•á‡§ú", correct: false },
                    { en: "Greek (Unani)", hi: "‡§Ø‡•Ç‡§®‡§æ‡§®‡•Ä", correct: true },
                    { en: "French", hi: "‡§´‡•ç‡§∞‡§æ‡§Ç‡§∏‡•Ä‡§∏‡•Ä", correct: false }
                ]
            },
            {
                id: 9,
                qEn: "Which statements are correct regarding Alexander?\n1. Alexander invaded India in 326 BC.\n2. Alexander's father Philip-II was ruler of Macedonia.\n3. Alexander's mother was Roxana.\n4. Alexander's wife was Olympias.",
                qHi: "‡§∏‡§ø‡§ï‡§Ç‡§¶‡§∞ ‡§ï‡•á ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠ ‡§Æ‡•á‡§Ç ‡§ï‡•å‡§® ‡§∏‡•á ‡§ï‡§•‡§® ‡§∏‡§π‡•Ä ‡§π‡•à :\n1. ‡§∏‡§ø‡§ï‡§Ç‡§¶‡§∞ 326 ‡§à.‡§™‡•Ç. ‡§Æ‡•á‡§Ç ‡§≠‡§æ‡§∞‡§§ ‡§™‡§∞ ‡§Ü‡§ï‡•ç‡§∞‡§Æ‡§£ ‡§ï‡§ø‡§Ø‡§æ ‡§•‡§æ\n2. ‡§∏‡§ø‡§ï‡§Ç‡§¶‡§∞ ‡§ï‡§æ ‡§™‡§ø‡§§‡§æ ‡§´‡§ø‡§≤‡§ø‡§™-2 ‡§Æ‡§ï‡§¶‡•Ç‡§®‡§ø‡§Ø‡§æ ‡§ï‡§æ ‡§∂‡§æ‡§∏‡§ï ‡§•‡§æ\n3. ‡§∏‡§ø‡§ï‡§Ç‡§¶‡§∞ ‡§ï‡•Ä ‡§Æ‡§æ‡§Å ‡§∞‡•Ç‡§ñ‡§∏‡§æ‡§®‡§æ ‡§•‡•Ä\n4. ‡§∏‡§ø‡§ï‡§Ç‡§¶‡§∞ ‡§ï‡•Ä ‡§™‡§§‡•ç‡§®‡•Ä ‡§ì‡§≤‡•ã‡§™‡§ø‡§Ø‡§∏ ‡§•‡•Ä",
                options: [
                    { en: "1 and 2", hi: "1 ‡§î‡§∞ 2", correct: true },
                    { en: "1, 2 and 4", hi: "1, 2, ‡§î‡§∞ 4", correct: false },
                    { en: "2, 3 and 4", hi: "2, 3 ‡§î‡§∞ 4", correct: false },
                    { en: "1, 2, 3 and 4", hi: "1, 2, 3 ‡§î‡§∞ 4", correct: false }
                ]
            },
            {
                id: 10,
                qEn: "Which sequence of Gurus (Teachers) is correct among the following?",
                qHi: "‡§®‡§ø‡§Æ‡•ç‡§® ‡§Æ‡•á‡§Ç ‡§ó‡•Å‡§∞‡•Ç‡§ì‡§Ç ‡§ï‡§æ ‡§ï‡•å‡§®-‡§∏‡§æ ‡§ï‡•ç‡§∞‡§Æ ‡§∏‡§π‡•Ä ‡§π‡•à?",
                options: [
                    { en: "Alexander-Aristotle-Socrates-Plato", hi: "‡§∏‡§ø‡§ï‡§Ç‡§¶‡§∞-‡§Ö‡§∞‡§∏‡•ç‡§§‡•Å-‡§∏‡•Å‡§ï‡§∞‡§æ‡§§-‡§™‡•ç‡§≤‡•á‡§ü‡•ã", correct: false },
                    { en: "Alexander-Plato-Aristotle-Socrates", hi: "‡§∏‡§ø‡§ï‡§Ç‡§¶‡§∞-‡§™‡•ç‡§≤‡•á‡§ü‡•ã-‡§Ö‡§∞‡§∏‡•ç‡§§‡•Å-‡§∏‡•Å‡§ï‡§∞‡§æ‡§§", correct: false },
                    { en: "Aristotle-Alexander-Plato-Socrates", hi: "‡§Ö‡§∞‡§∏‡•ç‡§§‡•Å-‡§∏‡§ø‡§ï‡§Ç‡§¶‡§∞-‡§™‡•ç‡§≤‡•á‡§ü‡•ã-‡§∏‡•Å‡§ï‡§∞‡§æ‡§§", correct: false },
                    { en: "Socrates-Plato-Aristotle-Alexander", hi: "‡§∏‡•Å‡§ï‡§∞‡§æ‡§§-‡§™‡•ç‡§≤‡•á‡§ü‡•ã-‡§Ö‡§∞‡§∏‡•ç‡§§‡•Å-‡§∏‡§ø‡§ï‡§Ç‡§¶‡§∞", correct: true }
                ]
            },
            {
                id: 11,
                qEn: "Which statement is incorrect regarding Alexander?",
                qHi: "‡§∏‡§ø‡§ï‡§Ç‡§¶‡§∞ ‡§ï‡•á ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠ ‡§Æ‡•á‡§Ç ‡§ï‡•å‡§®-‡§∏‡§æ ‡§ï‡§•‡§® ‡§ó‡§≤‡§§ ‡§π‡•à?",
                options: [
                    { en: "Alexander was born in 356 AD", hi: "‡§∏‡§ø‡§ï‡§Ç‡§¶‡§∞ ‡§ï‡§æ ‡§ú‡§®‡•ç‡§Æ 356 AD ‡§Æ‡•á‡§Ç ‡§π‡•Å‡§Ü ‡§•‡§æ", correct: true },
                    { en: "Alexander's naval commander was Nearchus", hi: "‡§∏‡§ø‡§ï‡§Ç‡§¶‡§∞ ‡§ï‡§æ ‡§ú‡§≤ ‡§∏‡•á‡§®‡§æ‡§™‡§§‡§ø ‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§ï‡§∏ ‡§•‡§æ", correct: false },
                    { en: "Alexander's main commander was Seleucus Nicator", hi: "‡§∏‡§ø‡§ï‡§Ç‡§¶‡§∞ ‡§ï‡§æ ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§∏‡•á‡§®‡§æ‡§™‡§§‡§ø ‡§∏‡•á‡§≤‡•ç‡§Ø‡•Å‡§ï‡§∏ ‡§®‡§ø‡§ï‡•á‡§ü‡§∞ ‡§•‡§æ", correct: false },
                    { en: "Alexander's horse was named Bucephalus", hi: "‡§∏‡§ø‡§ï‡§Ç‡§¶‡§∞ ‡§ï‡•á ‡§ò‡•ã‡§°‡•á ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§¨‡§ä‡§ï‡•á‡§´‡§≤‡§æ ‡§•‡§æ", correct: false }
                ]
            },
            {
                id: 12,
                qEn: "Between whom was the Battle of Hydaspes / Jhelum / Vitasta fought?",
                qHi: "‡§π‡§æ‡§á‡§°‡•ç‡§∞‡•á‡§∏‡•ç‡§™‡•Ä‡§ú/‡§ù‡•á‡§≤‡§Æ/‡§µ‡§ø‡§§‡§∏‡•ç‡§§‡§æ ‡§ï‡§æ ‡§Ø‡•Å‡§¶‡•ç‡§ß ‡§ï‡§ø‡§®‡§ï‡•á ‡§¨‡•Ä‡§ö ‡§π‡•Å‡§Ü ‡§•‡§æ?",
                options: [
                    { en: "Alexander and Darius-1", hi: "‡§∏‡§ø‡§ï‡§Ç‡§¶‡§∞ ‡§î‡§∞ ‡§¶‡§æ‡§∞‡§æ-1", correct: false },
                    { en: "Alexander and Ambhi", hi: "‡§∏‡§ø‡§ï‡§Ç‡§¶‡§∞ ‡§î‡§∞ ‡§Ü‡§Æ‡•ç‡§≠‡•Ä", correct: false },
                    { en: "Alexander and Porus", hi: "‡§∏‡§ø‡§ï‡§Ç‡§¶‡§∞ ‡§î‡§∞ ‡§™‡•ã‡§∞‡§∏", correct: true },
                    { en: "Alexander and Sudas", hi: "‡§∏‡§ø‡§ï‡§Ç‡§¶‡§∞ ‡§î‡§∞ ‡§∏‡•Å‡§¶‡§æ‡§∏", correct: false }
                ]
            },
            {
                id: 13,
                qEn: "Which river did Alexander's army refuse to cross?",
                qHi: "‡§∏‡§ø‡§ï‡§Ç‡§¶‡§∞ ‡§ï‡•Ä ‡§∏‡•á‡§®‡§æ ‡§®‡•á ‡§ï‡§ø‡§∏ ‡§®‡§¶‡•Ä ‡§ï‡•ã ‡§™‡§æ‡§∞ ‡§ï‡§∞‡§®‡•á ‡§∏‡•á ‡§Æ‡§®‡§æ ‡§ï‡§∞ ‡§¶‡§ø‡§Ø‡§æ ‡§•‡§æ?",
                options: [
                    { en: "Jhelum", hi: "‡§ù‡•á‡§≤‡§Æ", correct: false },
                    { en: "Ravi", hi: "‡§∞‡§æ‡§µ‡§ø", correct: false },
                    { en: "Sutlej", hi: "‡§∏‡§§‡§≤‡§ú", correct: false },
                    { en: "Beas (Vyas)", hi: "‡§µ‡•ç‡§Ø‡§æ‡§∏", correct: true }
                ]
            },
            {
                id: 14,
                qEn: "Which statements are correct regarding Alexander?\n1. Alexander returned from India in 325 BC.\n2. Alexander died in 323 BC in Babylon.\n3. Babylon is in Iran.\n4. Alexander founded cities named Nicaea, Bucephala and Alexandria.",
                qHi: "‡§∏‡§ø‡§ï‡§Ç‡§¶‡§∞ ‡§ï‡•á ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠ ‡§Æ‡•á‡§Ç ‡§ï‡•å‡§®-‡§∏‡§æ ‡§ï‡§•‡§® ‡§∏‡§π‡•Ä ‡§π‡•à ?\n1. ‡§∏‡§ø‡§ï‡§Ç‡§¶‡§∞ 325 BC ‡§Æ‡•á‡§Ç ‡§≠‡§æ‡§∞‡§§ ‡§∏‡•á ‡§µ‡§æ‡§™‡§∏ ‡§≤‡•å‡§ü‡§æ ‡§•‡§æ‡•§\n2. ‡§∏‡§ø‡§ï‡§Ç‡§¶‡§∞ ‡§ï‡•Ä ‡§Æ‡•É‡§§‡•ç‡§Ø‡•Å 323 BC ‡§Æ‡•á‡§Ç ‡§¨‡•á‡§¨‡•Ä‡§≤‡•ã‡§® ‡§Æ‡•á ‡§π‡•Å‡§à ‡§•‡•Ä\n3. ‡§¨‡•á‡§¨‡•Ä‡§≤‡•ã‡§® ‡§à‡§∞‡§æ‡§® ‡§Æ‡•á‡§Ç ‡§π‡•à\n4. ‡§∏‡§ø‡§ï‡§Ç‡§¶‡§∞ ‡§®‡•á ‡§®‡§ø‡§ï‡•à‡§Ø‡§æ, ‡§¨‡§â‡§ï‡•á‡§´‡§≤‡§æ ‡§î‡§∞ ‡§∏‡§ø‡§ï‡§®‡•ç‡§¶‡§∞‡§ø‡§Ø‡§æ ‡§®‡§æ‡§Æ‡§ï ‡§®‡§ó‡§∞ ‡§¨‡§∏‡§æ‡§Ø‡§æ",
                options: [
                    { en: "1, 2 and 3", hi: "1, 2 ‡§î‡§∞ 3", correct: false },
                    { en: "1, 2 and 4", hi: "1, 2 ‡§î‡§∞ 4", correct: true },
                    { en: "2, 3 and 4", hi: "2, 3 ‡§î‡§∞ 4", correct: false },
                    { en: "All", hi: "‡§∏‡§≠‡•Ä", correct: false }
                ]
            },
            {
                id: 15,
                qEn: "Which historian said that 'Alexander came like a storm and went away, but India remained unchanged'?",
                qHi: "‡§ï‡§ø‡§∏ ‡§á‡§§‡§ø‡§π‡§æ‡§∏‡§ï‡§æ‡§∞ ‡§®‡•á ‡§ï‡§π‡§æ ‡§•‡§æ ‡§ï‡§ø ‡§∏‡§ø‡§ï‡§Ç‡§¶‡§∞ ‡§Ü‡§Ç‡§ß‡•Ä ‡§ï‡•Ä ‡§§‡§∞‡§π ‡§Ü‡§Ø‡§æ ‡§î‡§∞ ‡§ö‡§≤‡§æ ‡§ó‡§Ø‡§æ ‡§™‡§∞‡§Ç‡§§‡•Å ‡§≠‡§æ‡§∞‡§§ ‡§Ö‡§™‡§∞‡§ø‡§µ‡§∞‡•ç‡§§‡§ø‡§§ ‡§∞‡§π‡§æ‡•§",
                options: [
                    { en: "Cunningham", hi: "‡§ï‡§®‡§ø‡§Ç‡§ò‡§Æ", correct: false },
                    { en: "Vincent Smith", hi: "‡§µ‡§ø‡§∏‡•á‡§Ç‡§ü ‡§∏‡•ç‡§Æ‡§ø‡§•", correct: true },
                    { en: "Aurel Stein", hi: "‡§Ü‡§∞‡•á‡§≤ ‡§∏‡•ç‡§ü‡§æ‡§á‡§®", correct: false },
                    { en: "Herodotus", hi: "‡§π‡•á‡§∞‡•ã‡§°‡•ã‡§ü‡•ç‡§∏", correct: false }
                ]
            },
            {
                id: 16,
                qEn: "Which republic strongly opposed Alexander while he was returning?",
                qHi: "‡§∏‡§ø‡§ï‡§Ç‡§¶‡§∞ ‡§ï‡•ã ‡§µ‡§æ‡§™‡§∏ ‡§≤‡•å‡§ü‡§§‡•á ‡§∏‡§Æ‡§Ø ‡§ï‡§ø‡§∏ ‡§ó‡§£‡§∞‡§æ‡§ú‡•ç‡§Ø ‡§®‡•á ‡§â‡§∏‡§ï‡§æ ‡§™‡•ç‡§∞‡§¨‡§≤ ‡§µ‡§ø‡§∞‡•ã‡§ß ‡§ï‡§ø‡§Ø‡§æ ‡§•‡§æ?",
                options: [
                    { en: "By Malava and Shudrak republics", hi: "‡§Æ‡§æ‡§≤‡§µ‡§æ ‡§§‡§•‡§æ ‡§ï‡•ç‡§∑‡•Å‡§¶‡•ç‡§∞‡§ï ‡§ó‡§£‡•ã‡§Ç ‡§ï‡•á ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ", correct: true },
                    { en: "By ruler of Gandhara", hi: "‡§ó‡§Ç‡§ß‡§æ‡§∞ ‡§ï‡•á ‡§∂‡§æ‡§∏‡§ï ‡§ï‡•á ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ", correct: false },
                    { en: "By ruler of Kamboj", hi: "‡§ï‡§Ç‡§¨‡•ã‡§ú ‡§ï‡•á ‡§∂‡§æ‡§∏‡§ï ‡§ï‡•á ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ", correct: false },
                    { en: "Ashvaka Republic", hi: "‡§Ö‡§∂‡•ç‡§µ‡§ï ‡§ó‡§£‡§∞‡§æ‡§ú‡•ç‡§Ø", correct: false }
                ]
            },
            {
                id: 17,
                qEn: "In which republic did the women take up arms after the male soldiers were killed?",
                qHi: "‡§ï‡§ø‡§∏ ‡§ó‡§£‡§∞‡§æ‡§ú‡•ç‡§Ø ‡§ï‡•á ‡§™‡•Å‡§∞‡•Ç‡§∑ ‡§∏‡•à‡§®‡§ø‡§ï‡•ã ‡§ï‡•á ‡§Æ‡§æ‡§∞‡•á ‡§ú‡§æ‡§®‡•á ‡§ï‡•á ‡§™‡§∂‡•ç‡§ö‡§æ‡§§‡•ç ‡§µ‡§π‡§æ‡§Å ‡§ï‡•Ä ‡§∏‡•ç‡§§‡•ç‡§∞‡§ø‡§Ø‡•ã ‡§®‡•á ‡§∂‡§∏‡•ç‡§§‡•ç‡§∞ ‡§ß‡§æ‡§∞‡§£ ‡§ï‡§ø‡§Ø‡§æ ‡§•‡§æ?",
                options: [
                    { en: "Kamboj", hi: "‡§ï‡§Ç‡§¨‡•ã‡§ú", correct: false },
                    { en: "Ashvaka (Massaga)", hi: "‡§Ö‡§∂‡•ç‡§µ‡§ï", correct: true },
                    { en: "Malla", hi: "‡§Æ‡§≤‡•ç‡§≤", correct: false },
                    { en: "Gandhara", hi: "‡§ó‡§Ç‡§ß‡§æ‡§∞", correct: false }
                ]
            },
            {
                id: 18,
                qEn: "Consider the following statements regarding the results of contact between India and Iranians?\n1. Arrival of Kharoshthi script\n2. Iranian influence on architecture\n3. Establishment of trade relations",
                qHi: "‡§≠‡§æ‡§∞‡§§ ‡§î‡§∞ ‡§à‡§∞‡§æ‡§®‡•Ä ‡§ï‡•á ‡§Æ‡§ß‡•ç‡§Ø ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï‡•ã ‡§ï‡•á ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ‡•ã‡§Ç ‡§ï‡•á ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠ ‡§Æ‡•á ‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§ï‡§•‡§®‡•ã‡§Ç ‡§™‡§∞ ‡§µ‡§ø‡§ö‡§æ‡§∞ ‡§ï‡•Ä‡§ú‡§ø‡§Ø‡•á ?\n1. ‡§ñ‡§∞‡•ã‡§∑‡•ç‡§†‡•Ä ‡§≤‡§ø‡§™‡§ø ‡§ï‡§æ ‡§Ü‡§ó‡§Æ‡§® ‡§π‡•Å‡§Ü\n2. ‡§∏‡•ç‡§•‡§æ‡§™‡§§‡•ç‡§Ø ‡§ï‡§≤‡§æ ‡§™‡§∞ ‡§à‡§∞‡§æ‡§®‡•Ä ‡§™‡•ç‡§∞‡§≠‡§æ‡§µ ‡§™‡§°‡§º‡§æ\n3. ‡§µ‡•ç‡§Ø‡§æ‡§™‡§æ‡§∞ ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡•ã‡§Ç ‡§ï‡•Ä ‡§∏‡•ç‡§•‡§æ‡§™‡§®‡§æ ‡§π‡•Å‡§à",
                options: [
                    { en: "1 and 2", hi: "1 ‡§î‡§∞ 2", correct: false },
                    { en: "2 and 3", hi: "2 ‡§î‡§∞ 3", correct: false },
                    { en: "1 and 3", hi: "1 ‡§î‡§∞ 3", correct: false },
                    { en: "1, 2 and 3", hi: "1, 2 ‡§î‡§∞ 3", correct: true }
                ]
            },
            {
                id: 19,
                qEn: "Who among the following was NOT a historian who came to India with Alexander?",
                qHi: "‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§Æ‡•á‡§Ç ‡§∏‡•á ‡§ï‡•å‡§® ‡§∏‡§ø‡§ï‡§Ç‡§¶‡§∞ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§≠‡§æ‡§∞‡§§ ‡§Ü‡§®‡•á‡§µ‡§æ‡§≤‡§æ ‡§á‡§§‡§ø‡§π‡§æ‡§∏‡§ï‡§æ‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§•‡§æ ?",
                options: [
                    { en: "Nearchus", hi: "‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§ï‡§∏", correct: false },
                    { en: "Onesicritus", hi: "‡§è‡§®‡§æ‡§∏‡§ø‡§ï‡•ç‡§∞‡§ø‡§ü‡§ø‡§∏", correct: false },
                    { en: "Aristobulus", hi: "‡§è‡§∞‡§ø‡§∏‡•ç‡§ü‡•ã‡§¨‡•Å‡§≤‡§∏", correct: false },
                    { en: "Herodotus", hi: "‡§π‡•á‡§∞‡•ã‡§°‡•ã‡§ü‡•ç‡§∏", correct: true }
                ]
            }
        ];

        // --- STATE & DOM ---
        let state = {
            questions: [],
            currentIdx: 0,
            score: 0,
            timer: null,
            timeLimit: 0,
            timeLeft: 0
        };

        const screens = {
            start: document.getElementById('start-screen'),
            quiz: document.getElementById('quiz-screen'),
            result: document.getElementById('result-screen')
        };

        const ui = {
            counter: document.getElementById('question-counter'),
            score: document.getElementById('score-display'),
            timerBox: document.getElementById('timer-display'),
            timeLeft: document.getElementById('time-left'),
            progressBar: document.getElementById('progress-bar'),
            qTextEn: document.getElementById('q-text-en'),
            qTextHi: document.getElementById('q-text-hi'),
            options: document.getElementById('options-container'),
            finalScore: document.getElementById('final-score'),
            totalQs: document.getElementById('total-qs'),
            msg: document.getElementById('result-message'),
            emoji: document.getElementById('emoji-display')
        };

        // --- AUDIO (Web Audio API) ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function synthesizeSound(type) {
            if(audioCtx.state === 'suspended') audioCtx.resume();
            
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            if (type === 'correct') {
                // High pitch 'Ting'
                osc.type = 'sine';
                osc.frequency.setValueAtTime(600, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.5);
            } else if (type === 'wrong') {
                // Low pitch 'Buzz'
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.3);
            }
        }

        // --- LOGIC ---
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function startQuiz() {
            // Setup Settings
            const timerVal = parseInt(document.getElementById('timerInput').value);
            const doShuffle = document.getElementById('shuffleToggle').checked;
            
            state.timeLimit = isNaN(timerVal) ? 0 : timerVal;
            
            // Clone and Shuffle if needed
            state.questions = JSON.parse(JSON.stringify(rawQuestions));
            if(doShuffle) shuffleArray(state.questions);

            // Reset State
            state.currentIdx = 0;
            state.score = 0;
            
            // Switch Screen
            switchScreen('quiz');
            loadQuestion();
        }

        function switchScreen(screenName) {
            Object.values(screens).forEach(s => s.classList.remove('active'));
            screens[screenName].classList.add('active');
        }

        function loadQuestion() {
            if(state.currentIdx >= state.questions.length) {
                endQuiz();
                return;
            }

            const q = state.questions[state.currentIdx];
            
            // UI Update
            ui.counter.innerText = `Q: ${(state.currentIdx + 1).toString().padStart(2,'0')}/${state.questions.length}`;
            ui.score.innerText = `Score: ${state.score}`;
            ui.qTextEn.innerText = q.qEn.replace(/\n/g, '<br>'); // Handle newlines
            ui.qTextHi.innerText = q.qHi.replace(/\n/g, '<br>');
            
            // Progress Bar
            const pct = (state.currentIdx / state.questions.length) * 100;
            ui.progressBar.style.width = `${pct}%`;

            // Options
            ui.options.innerHTML = '';
            q.options.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerHTML = `<div class="opt-en">${opt.en}</div><div class="opt-hi">${opt.hi}</div>`;
                btn.onclick = () => checkAnswer(idx, btn, q.options);
                ui.options.appendChild(btn);
            });

            // Timer
            clearInterval(state.timer);
            ui.timerBox.classList.remove('danger');
            
            if(state.timeLimit > 0) {
                ui.timerBox.style.display = 'flex';
                state.timeLeft = state.timeLimit;
                ui.timeLeft.innerText = state.timeLeft;
                
                state.timer = setInterval(() => {
                    state.timeLeft--;
                    ui.timeLeft.innerText = state.timeLeft;
                    
                    if(state.timeLeft <= 5) ui.timerBox.classList.add('danger');
                    
                    if(state.timeLeft <= 0) {
                        clearInterval(state.timer);
                        synthesizeSound('wrong');
                        // Auto move next if time runs out (treat as wrong)
                        disableButtons();
                        setTimeout(() => {
                            state.currentIdx++;
                            loadQuestion();
                        }, 1500);
                    }
                }, 1000);
            } else {
                ui.timerBox.style.display = 'none';
            }
        }

        function checkAnswer(selectedIdx, btnElement, allOptions) {
            clearInterval(state.timer);
            disableButtons();

            const isCorrect = allOptions[selectedIdx].correct;
            
            if(isCorrect) {
                state.score++;
                btnElement.classList.add('correct');
                synthesizeSound('correct');
                fireConfetti();
            } else {
                btnElement.classList.add('wrong');
                // Find and highlight correct
                const btns = ui.options.querySelectorAll('.option-btn');
                allOptions.forEach((opt, i) => {
                    if(opt.correct) btns[i].classList.add('correct');
                });
                synthesizeSound('wrong');
                triggerEmoji();
            }

            setTimeout(() => {
                state.currentIdx++;
                loadQuestion();
            }, 1500);
        }

        function disableButtons() {
            const btns = ui.options.querySelectorAll('.option-btn');
            btns.forEach(b => b.disabled = true);
        }

        function triggerEmoji() {
            ui.emoji.classList.add('show');
            setTimeout(() => ui.emoji.classList.remove('show'), 1000);
        }

        function endQuiz() {
            clearInterval(state.timer);
            switchScreen('result');
            
            // Calc stats
            // If user clicked Finish early, questions answered is currentIdx. 
            // Total questions remains length of array.
            const total = state.questions.length;
            const percentage = (state.score / total) * 100;

            ui.finalScore.innerText = state.score;
            ui.totalQs.innerText = `/ ${total}`;

            let msg = "";
            if(percentage >= 80) msg = "üèÜ Outstanding Performance!";
            else if(percentage >= 50) msg = "üëè Well Done! Keep it up.";
            else msg = "üìö Practice makes perfect! Try again.";

            ui.msg.innerText = msg;
        }

        // --- CONFETTI (Pure JS Canvas) ---
        const canvas = document.getElementById('confetti-canvas');
        const ctx = canvas.getContext('2d');
        let particles = [];

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        function fireConfetti() {
            for(let i=0; i<100; i++) {
                particles.push({
                    x: canvas.width / 2,
                    y: canvas.height / 2,
                    vx: (Math.random() - 0.5) * 10,
                    vy: (Math.random() - 0.5) * 10 - 5,
                    color: `hsl(${Math.random()*360}, 100%, 50%)`,
                    size: Math.random() * 8 + 2,
                    life: 100
                });
            }
            animateConfetti();
        }

        function animateConfetti() {
            if(particles.length === 0) return;
            
            ctx.clearRect(0,0, canvas.width, canvas.height);
            
            particles.forEach((p, index) => {
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.2; // Gravity
                p.life--;
                
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
                ctx.fill();

                if(p.life <= 0) particles.splice(index, 1);
            });

            requestAnimationFrame(animateConfetti);
        }

    </script>
</body>
</html>